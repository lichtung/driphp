/**
 * 异步延时加载
 * Created by Lin on 2015/5/16.
 * Email : 784855684@qq.com
 * Version:1.1.150528
 */
function Lazerloader(){var c=Lazerloader.prototype,d=this,a={};window.console=window.console||function(){var a={};a.log=a.warn=a.debug=a.info=a.error=a.time=a.dir=a.profile=a.clear=a.exception=a.trace=a.assert=function(){};return a}();c.hasAttr=function(b){return void 0!==a[b]};c.set=function(b,e,k){return d.hasAttr(b)||!0===k?(a[b]=e,!0):!1};c.get=function(b){return a[b]};c.init=function(b){a.url="source.php";a.total=0;a.predata=null;a.cur=0;a.size=10;a.ctnselector="body";a.tplid="";a.delay=0;a.tag=
    "gettotal";a.precall=null;a.loadcall=null;a.isfirst=!0;a.curtpl=null;a.curclone=null;for(var e in b)d.set(e,b[e],!1);b=$("#"+a.tplid);b.length&&b.css("display","none");return d};c.doAjax=function(b,e,d,c,g){var f=null;e.curindex=a.cur;e.size=a.size;e.total=a.total;$.ajax({type:"POST",url:a.url,data:e,async:null===d?!0:d,success:function(a){f=eval("("+a+")");null!==c&&void 0!==c&&c(f,g)}});return d?void 0:f};c.getClone=function(a,e,d){a=e.find(a).eq(0).clone().css("display","").css("height","auto").removeAttr("id");
    !0!==d&&a.html("");return a};c.nestThrough=function(b,e,c){if(e instanceof Object)for(var h in e)if(isNaN(h)){if(!(e[h]instanceof Object)){var g=d.getClone("."+b,a.curtpl,!0),f;for(f in e)g.find("."+f).html(e[f]);c.append(g);break}}else{g=d.getClone("."+b,a.curtpl,!0);if(e[h]instanceof Object)for(f in e[h])g.find("."+f).html(e[h][f]);c.append(g)}else g=d.getClone("."+b,a.curtpl).html(e),c.append(g)};c.loadTemplate=function(b,e){for(var c=0;c<e.length;c++){a.curtpl=$("#"+a.tplid,$(a.ctnselector));
    a.curclone=d.getClone("#"+a.tplid,$(a.ctnselector));for(var h in e[c])d.nestThrough(h,e[c][h],a.curclone);$(a.ctnselector).append(a.curclone)}};c.loadData=function(b,c){d.loadTemplate(a.tplid,b.data);a.loadcall&&a.loadcall(b)};c.autoLoad=function(){a.isfirst&&0<a.predata.length&&(d.doAjax(a.url,{tag:a.tag,keydata:a.predata.slice(a.cur,a.cur+a.size)},!0,d.loadData,null),a.cur+=a.size,a.isfirst=!1);setTimeout(function(){if(a.cur<a.total)return d.doAjax(a.url,{tag:a.tag,keydata:a.predata.slice(a.cur,
    a.cur+a.size)},!0,d.loadData,null),a.cur+=a.size,d.autoLoad()},a.delay)};c.preload=function(){var b=d.doAjax(a.url,{tag:a.tag},!1,null,null);if(b)a.predata=b.data,a.total=b.total||a.predata.length,d.loadTemplate(a.tplid,b.data);else return console.log(b),alert("can not get init param\uff01"),!1;a.tag="getdata";a.precall&&a.precall(b);return!0};c.hadInit=function(){return d.hasAttr("url")};c.start=function(){if(!d.hadInit())return alert("have inited?");if(!d.preload())return alert("network exception!");
    d.autoLoad();return d}};