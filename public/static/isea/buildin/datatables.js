isea.datatables = {
    openimage: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABGdBTUEAANbY1E9YMgAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAMDSURBVHjarFXdS5NRGH/eufyK2ZZWvqKiyZQQpQ9hNKVIHZLzpq7Ey8SbQhG66R+IPqCuCqKLrsK8kbCMhcOwNdimglZ24WSVHyxzVjqZQ9+P0/Mcz1upE7vwjB/nnOfjt3Oej/NKkHqYEGmIA4h0saahITYQiljr2x2lFHszIgthQeQgDgpSEGQJRByxikgiVARLdSoiy0QcRVR2dHRc8fv9nmg0OqvrukagNclIRzbCNjPFwbiATlWAcPT39z9VFGWD7TJIRzZkK3y2kEriSvmyLJ+LRCIfySmpJZk3Nsiuf+pmLaGLrDnYxLonO9mr7wMsoSY4MdmSD/oeExySJBJAsSoOBoN3HQ5H07KyDI+/PoI3S0M8OGTEpM1I0VR7uA6ull6D3PQ8CAQCHqfTeQPFMxRXI5O2rq6uhvb29k4NNOlO+DYMx4bRH386gv0DXYeZ5AxE1iJw4Ug9FBcWl8VisYnR0dFZSpJJEB5qbW29JEmS6d2SD3wxH2gaUmsqqLoG3roh8NYO8T1mB1TUjf0Yg7f4p+TT1tZ2WdzSbBBml5eXn6SAeqKvQVWRTFdBUdFZVf9kjuRch4QKknu+ebi8oqKCfLMpjmZRtOlWqzWXlFPxKXRQ8LISBFyBLaXgq/fz2ek9y+fPq1/4bLFYrEYDmLfXD8WMTrazsv4OVVN5qtaVjc0ywWsbOrPRTvF4/JfNZsuTM2SYW53nKT01cJrP4y3j3NjYi7xDQU4Bl6PvT9FFmkn05Vo4HJ4gpSvfxeO2GS+VJ8AYioghnZDWjXIjl09PT38gDjIxCFd6enr6sCz05sJmqLJWcSIOdDzRV8nBsy5kdosdWorcVEp6b2/vc9HfSppxh1AoFHe73faSopKyM3k1EF4J49XnttSizvgOqm3VcKvmJsjZMoyMjAxibz9Bjph4LFK33mJykT2YfMgaXrrY8Wd2Voo4/6Ke3Xt/n0UT0e2tl2+03n49Dlm7vTg7nq+FhYV5g4jWez1f//vAZgj9+l4PrLTfn4DfAgwAXP8AAdHdgRsAAAAASUVORK5CYII=",
    closeimage: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABGdBTUEAANbY1E9YMgAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAALbSURBVHjarFVNTFNBEJ4tFVuw0gaj1Jhe5OdgJV5Iaw+CGAMKIdET4Sgh4SIHDcYLN07oiZOGqyFcjOECISEhwRpoGxLExAMVAi9NadIgWNLW8t7bdWa7L0Ap6oFtvsy+3Zlvd2ZnpnYoP2yICsQFRKWa0zARhwhdzXmpob3km6k1J8KFuIyoVqSgyLKIDOIAkUcYCFHuVkTmQFxF3BoYGHgWDodnk8mkxjk3CTSnNdojHaXrULanyOhW1xGB6enpD7quH4ozBu2RDukqmxOkTLlU5/V6721sbHwjI57Pi9z8vNgdHhY7PT0i1d0tdl+8FNmZGcGzWUlMumSDttcUB2PqAShWvuXl5bFAINDB9/chMzEBuYWF4rGMgsSACQECTRyhENQMDkJFbS0sLS3NhkKh16i1TXG1XtIzNDT0oL+//zmYJtt7Mwa5xc+Al0AmDlwKJKMfrunaNhibm+Bsa4MbPt/NdDq9GovFNHokmyKs6e3tfcIYs+XDYciGvwA3TQnT5EXJaW6qdQ65lRU8dBHIpq+v76ny0m4RVjU2Nt4h7w7m5qRhKY4OOALp0mhqaiLbKoqjXSVtpdvtrqXNfDwuldE3qMcblBs/WlulLGxtSelyudxWAZQmtkx90zTgb8M0DPlQTNeLaYJuH68UWU6ZTGbP4/FcqfB64XciIZ/2e/CuSixVCMeErAJvnfxG25+qikybqsvc+vr6qrx+e7uKkXEEQ8WNcxXPorx0v10SxuPxNeIgLovw1+Tk5EfKZ3dHBzj8/qIxt0gUkUWMh1TW14Pn8SNKIz41NfVJ1bd+IrGj0ejblpaWhwVNA210FA6iEfSPFV203EZnq5ubwTcyAs6GBohEInPBYPAVbmiKtHzpHabTIvnuvVjr6hIx/20R9fvF185OkRgfF4WdndLSq7NK77yag/OsjnOqfaVSqYRFRPN/tS/2nw32otov/KvBsvP+C/gjwAC23ACdhngbNwAAAABJRU5ErkJggg==",
    resourceList: [
        'http://cdn.bootcss.com/datatables/1.10.11/css/dataTables.bootstrap.css',
        'http://cdn.bootcss.com/datatables/1.10.13/js/jquery.dataTables.js',
        'http://cdn.bootcss.com/datatables/1.10.12/js/dataTables.bootstrap.js'
    ],
    style: {},//
    api: null,//datatable的API对象
    ele: null, // datatable的jquery对象 dtElement
    cr: null,//当前操作的行,行多选时将是多行的数组
    option: {
        onselect: 0,//单选择或者多选择
        config: {
            language: {
                emptyTable: '没有数据',
                loadingRecords: '加载中...',
                processing: '查询中...',
                search: '检索:',
                lengthMenu: '每页 _MENU_ 记录',
                zeroRecords: '没有数据',
                paginate: {
                    first: '<<',
                    last: '>>',
                    next: '>',
                    previous: '<'
                },
                info: '第 _PAGE_ 页 / 总 _PAGES_ 页 / 总 _TOTAL_ 记录',
                infoEmpty: '没有数据',
                infoFiltered: '(过滤总数 _MAX_ 记录)'
            },
            paging: true,
            lengthChange: true,
            searching: true,
            ordering: true,
            order: [], /* 重要：禁止了自动排序id*/
            info: true,
            autoWidth: false,
            lengthMenu: [[10, 25, 50, -1], [10, 25, 50, "全部"]],
            columns: []
        }
    },
    //设置之后的操作所指定的DatatableAPI对象
    solve: function (call) {
        isea.loader.load(this.resourceList, call);
    },
    create: function (dt, opt) {
        var ns = isea.clone(this);
        ns.ele = $(dt);
        if (opt) {
            if (Array.isArray(opt)) {
                /** 如果是数组，则是列的配置，否则为完整配置 */
                ns.option.config.columns = opt;
            } else {
                isea.init(opt, ns.option, true);
            }
            console.log(ns.option.config.columns);
            ns.api = ns.ele.DataTable(ns.option.config);
        } else {
            ns.api = ns.ele.DataTable();
        }
        if (!(ns.ele.selector in this.style)) {
            this.style[ns.ele.selector] = $("<style>" + ns.ele.selector + " tbody tr.selected {background-color: #b0bed9;}</style>");
            this.style[ns.ele.selector].appendTo($("head"));
        }
        return ns;
    },
    table: function () {
        return this.ele;
    },
    reload: function () {
        this.api.ajax.reload();
    },
    //为tableapi对象加载数据,参数二用于清空之前的数据
    load: function (data, clear) {
        if (isea.util.isStr(data)) {
            data = isea.util.toObj(data);
            /* T json string to json object */
        }
        if (isea.util.isObj(data)) {
            /* for appending a row */
            data = [data];
        }
        if (false !== clear) {
            this.api.clear();
        }
        this.api.rows.add(data).draw();
        return this;
    },
    selected: function () {
        var selected = this.ele.find("tr.selected");
        return selected.length ? selected : false;
        /* it will return false if no row is selected */
    },
    //表格发生了draw事件时设置调用函数(表格加载,翻页都会发生draw事件)
    onDraw: function (callback, rowclickcall) {
        var env = this;
        if (env.ele) {
            env.ele.on("draw.dt", function (event, settings) {
                callback && callback(event, settings);
                env.ele.find("tr").unbind("click").click(function () {
                    var thistr = $(this);
                    rowclickcall && rowclickcall(thistr);
                    switch (env.option.onselect) {
                        case 1:
                            if (thistr.hasClass('selected')) {
                                thistr.removeClass('selected');
                            } else {
                                thistr.closest("table").find("tr").removeClass("selected");
                                thistr.addClass('selected');
                            }
                            break;
                        case 2:
                            thistr.toggleClass('selected');
                            break;

                        case 0:
                        default:
                        /* do nothing */

                    }
                });
            });
        }
        return env;
    },
    add: function (content) {
        this.api.row.add(content).draw();
        return this;
    },
    remove: function (rows) {/*rows*/
        if (rows.length === 1) {
            this.api.row(rows).remove();
        } else {
            for (var i = 0; i < rows.length; i++) {
                this.api.row(rows.eq(i)).remove();
            }
        }
        return this.api.draw(false);
    },
    isChildShown: function (jqobj_tr) {
        return this.api.row(jqobj_tr).child.isShown();
    },
    search: function (word, index) {/*column index of integer , 'keyup change' */
        (index ? this.api.columns(index) : this.api).search(word).draw();
        return this;
    },
    //获取表格指定行的数据或者全部数据
    data: function (e) {
        if ((isea.util.gettype(e) === "boolean") || !e) {
            var data = this.api.data();
            if (true !== e) {
                var tmp = [];
                for (var i = 0; i < data.length; i++) {
                    tmp.push(data[i]);
                }
                data = tmp;
            }
            return data;
        } else {
            return this.api.row(this.cr = e).data();
        }
    },
    /**
     * @param data new data
     * @param row update row
     * @returns {*}
     */
    update: function (data, row) {
        if (row === undefined) row = this.cr;
        if (row) {
            if (Array.isArray(row)) {
                for (var i = 0; i < row.length; i++) {
                    this.update(data, row[i]);
                }
            } else {
                this.api.row(row).data(data).draw(false);
            }
        } else {
            console.log('no line choosed');
        }
    }
};